<!DOCTYPE html>
<html>
  <head>
    <!-- using bootstrap 4.3.1 -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/custom.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <!-- import logo Rsquare and Head -->
    <link rel="icon" href="images/logo/Artboard 1logo.png" />
    <script src="js/jquery-3.4.1.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>
    <title>R-SQUARE</title>

    
    <link href="MDB-Free/css/style.css" rel="stylesheet">

    <!-- JQuery -->
    
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="MDB-Free/js/mdb.min.js"></script>
    <!--CSS-->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <!-- /Head of the Card -->
    <div class="container">
    <div class="container-content">
    <div class="card-content">                   
      <div class="row">
        <h4 class="font-weight-bold justify-content-left vdark-blue">Responsible Organization</h4>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Organization</th>
              <th scope="col">President</th>
              <th></th>
            </tr>
          </thead>
          <tbody id ="table3">

          </tbody>
        </table>
        <div class="container text-right">
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#add-org-popup" id="add-org-popup-btn"> Add Organization </button>


<div class="modal fade" id="add-org-popup" tabindex="-1" role="dialog" aria-labelledby="add-place-popup-Title" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title vdark-blue"><b id="ModalTitleF0P0" style="padding-left: 1px;">Add Organization</b></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class = "row">
          </div>
          <div class ="row">
            <span class = "dark-blue">Search</span>
          </div>
          <form action="/findOrganization.php" method="get">
            <input type ="text" class="form-control" list="organizeList" id = "organize_search" name="organizeList" placeholder = "Search">
            <datalist id="organizeList"> 
              
            </datalist>
          </form>
          <div class="row">
            <span class="dark-blue" id="org">Organization Name:&nbsp</span>
            <span id="organize"> </span>
          </div>
          <div class="row">
            <span class = "dark-blue">President:&nbsp</span>
            <span id="organizeName"> </span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="btn2" data-dismiss="modal" style="display: block;">
          <span id="add-place-text">Add</span>
        </button>
      </div>
    </div>
  </div>
</div>

        </div>
      </div>
    </div>  
    </div>
    </div>
  </body>


<script>
  var id = '60070503429'; // initial id
  var orgs;  // all organization variable
  
    /** Display organization **/
    var xmlhttp = new XMLHttpRequest();
     xmlhttp.onreadystatechange = function()
     {
      if (this.readyState == 4 && this.status == 200)
      {
        let container = document.getElementById("table3");
        let tr_comp;
        orgs = JSON.parse(this.responseText);
        for (i=0; i<orgs.length; i++)
        {
          tr_comp = document.createElement("tr");
          tr_comp.innerHTML = "<td>" + orgs[i].organization + "</td><td>" + orgs[i].president_name + " " + orgs[i].president_surname+"</td>"+"<td><a onclick=\"confirmDeleteOrg('"+ orgs[i].organization_id +"')\"><u>Delete</u></a></td>";
         
          container.appendChild(tr_comp);
        }
      }
    };
      xmlhttp.open("GET", "getOrganization.php?userId=" + id , true);
      xmlhttp.send();

  /* Finding organization */
  var xmlhttp2 = new XMLHttpRequest;
  let rowOrganize = new Array();
  let dataOrganize;
  var addOrganize;
  xmlhttp2.onreadystatechange = function()
  {
    if (this.readyState == 4 && this.status == 200)
    {
      dataOrganize = JSON.parse(this.responseText);
      var container = document.getElementById("organizeList");
      console.log(dataOrganize);
      for(var i=0; i<dataOrganize.length;i++)
        {
          rowOrganize[i] = document.createElement("option");
          rowOrganize[i].setAttribute("class","search_list")
          // rowOrganize[i].setAttribute("id","organize")
          rowOrganize[i].value = dataOrganize[i].organization_id;
          rowOrganize[i].innerHTML =  dataOrganize[i].organization
          container.appendChild(rowOrganize[i]);
        }

        $(document).ready(function()
        {
          $("#organize_search").change(function()
          {
            if($(this).val() == '')// If There's no text in search box, it will show nothing
              {
              }
            else{
              var result = document.getElementById("organize_search").value; //Get data to searching
              //Searching for event in Index
              for(var j=0; j<dataOrganize.length;j++)
              {
                //Print event when it found
                if(
                  dataOrganize[j].organization_id == result)
                    {
                    document.getElementById("organize").innerHTML = dataOrganize[j].organization
                    document.getElementById("organizeName").innerHTML = dataOrganize[j].student_name +' '+dataOrganize[j].student_surname
                    addOrganize = dataOrganize[j];
                    addOrganize.userId = id;
                    }
                }
              }
          });
          
          $("#btn2").click(function()
          {
            // console.log(addOrganize);
            if(addOrganize == null)
              alert('Please find the organization first!');
            else
            {
              fetch("addResOrg.php",
              {
                method: "POST",
                body: JSON.stringify(addOrganize)
              }).then(async res => {
          //       debugging
                  const data = await res.text();
                  console.log("server res" + data);
                  window.location.reload();
                });
            }
          })      
        });

      }
    };
      xmlhttp2.open("GET", "findOrganization.php?userId=" + id, true);
      xmlhttp2.send();

  function confirmDeleteOrg(org_id)
  {
    let r = confirm("Do you want to delete?");
    if (r == true)
    {
      let ret = '{ "orgId":"' + org_id + '",' +
                '"id":"' + id + '"}'
      console.log(ret);
      fetch("delResOrg.php", {
      method: "POST",
      body: ret
    }).then(async res => {
    // const data = await res.text();
    // console.log("server res" + data);
    window.location.reload();
    });
    }
  }

</script>
</html>
