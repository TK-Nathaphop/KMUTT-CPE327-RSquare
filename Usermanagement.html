<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/custom.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        <link rel="icon" href="images/logo/Artboard 1logo.png">
        <script src="js/jquery-3.4.1.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/custom.js"></script>
        <!-- asdsadsad-->
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
        <link rel="stylesheet" href="dist/css/bootstrap-select.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!--<script src="dist/js/bootstrap-select.js"></script> -->

        <title>R-Square</title>
        <link rel="icon" href="picture/logo/Artboard 1logo.png" />
    </head>
  <body>
      <div id="nav-placeholder"> </div>
        <script>
            $.get("navigationbar.html", function(data){
                $("#nav-placeholder").replaceWith(data);
            });
        </script>
    <!-- /Head of the Card -->
    <div class="container">
      <div class="container">
        <div class="row justify-content-center">
          <h1 class="vdark-blue">View User</h1>
        </div>
        <div class="container-fluid">
          <!--------------------------------First Row------------------------------>
          <div class="row">
            <div class="col-3"  >
                <div id="col1"></div>
            </div>
            <!--Detail of User-->
            <!--Column of Detail User1-->
            <div class="col-5" id ="name">
            </div>
            <!--Column of Detail User2-->
            <div class="col-4" id="col2">
            </div>
          </div>
          <div class ="container">
            <!--------------------------------Second Row------------------------------>
            <div class="row">
              <h4 class="font-weight-bold justify-content-left text-primary">
                Responsible Activity Project
              </h4>
              <!--Table of Activity infomation-->
              <table class="table justify-content-left">
                <thead>
                  <tr>
                    <th scope="col">Project</th>
                    <th scope="col"> President</th>
                  </tr>
                </thead>
                <tbody id="table1">
                  <!-- Get data from script -->
                </tbody>
              </table>
            </div>
            <!-- Popup Add-Activity Button -->
            <div class = "row">
              <div class ="col-sm-10"></div>
              <div class = "col-sm-2">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@getbootstrap">Add Activity</button>

                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">

                    <!---------------------- Popup content ---------------------->
                    <div class="modal-content">
                      <div class="modal-body">
                        <div class="container-fluid">
                          <div class = "row justify-content-center">
                            <h3 class="vdark-blue font-weight-bold text-center"> Add Activity Project</h3>
                          </div>
                          <!---------------------- searching ---------------------->
                          <div class ="row">
                            <h4 class = "vdark-blue">Search</h4>
                          </div>
                          <!-- Input for Searching Event -->
                          <form action="/findActivity.php" method="get">
                            <input type ="text" class="form-control" list="myList" id = "search" name="myList" placeholder = "Search">
                            <datalist id="myList">
                              
                            </datalist>
                          </form>
                          <br>
                          <!-- Row1 -->
                          <div class="row">
                            <h4 class="vdark-blue" id="org">Organization:&nbsp</h4>
                            <h4 id=org_txt> </h4>
                          </div>
                          <!-- Row2 -->
                          <div class="row">
                            <h4 class = "vdark-blue">President:&nbsp</h4>
                            <h4 id=pre_org_txt> </h4>
                          </div>
                          <!-- Row3 -->
                          <div class="row ">
                            <div class="col-md-10"></div>
                            <div class = "col-sm-2">
                              <input class="btn btn-primary" type="submit" value="Submit" id ="btn1">
                            </div>
                          </div>
                          <br>
                        </div>
                      </div>
                    </div>
                    <!-- End of Content -->
                  </div>
                </div>
              </div>
            </div>
            <!--------------------------------Third Row------------------------------>
            <div class="row">
              <h4 class="font-weight-bold text-lg-left text-primary">
                Responsible Organization
              </h4>
              <div class = "table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Organization Name</th>
                      <th scope="col">President</th>
                    </tr>
                  </thead>
                  <tbody id="table3">
                  </tbody>
                </table>
              </div>
              <div class="row col-sm-4 col-sm-12">
                <button type="button" class="btn btn-primary" onclick="myfunction()" >
                  Add Organization
                </button>
              </div>
            </div>
            <!--------------------------------fourth Row------------------------------>
            <div class="row">
              <h4 class="font-weight-bold text-lg-left text-primary">
                Responsible Place
              </h4>
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Building</th>
                    <th scope="col">Floor</th>
                    <th scope ="col">Place</th>
                  </tr>
                </thead>
                <tbody id ="table4">
                </tbody>
              </table>
              <div class="container text-right">
                <button type="button" class="btn btn-primary" onclick="myfunction()">
                  Add Place
                </button>
              </div>
            </div>
          </div>
          <!-- /Card of Connent -->
        </div>
      </div>
    </div>
  </body>
  <!-- Script For First Row -->
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");
    var myObj , activityObj ; 

    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        myObj = JSON.parse(this.responseText);
        var container = document.getElementById("name");
        var div = document.createElement("div");
        div.innerHTML = "<div class = \"row\">"
        +"<h4 class =  \"vdark-blue\"> Name:</h4>" + ' '+"<h4>"+myObj.name + ' ' + myObj.surname +"</h4>"+"</div>"
        +"<div class = \"row\">"+"<h4 class =  \"vdark-blue\"> Faculty:</h4>" +' '+"<h4>"+ myObj.faculty+"</h4>"+"</div>"
        +"<div class = \"row\">"+"<h4 class =  \"vdark-blue\"> Position:</h4>" +' '+"<h4>"+ myObj.position+"</h4>"+"</div>";
          container.appendChild(div)
          
        var container = document.getElementById("col2");
        var div2 = document.createElement("div");
          div2.innerHTML = 
        "<div class = \"row\">"+"<h4 class =  \"vdark-blue\"> Roke:</h4>" +"<h4>"+ myObj.role+"</h4>"+"</div>"
        +"<div class = \"row\">"+"<h4 class =  \"vdark-blue\"> Department:</h4>" +"<h4>"+ myObj.department+"</h4>"+"</div>";
          container.appendChild(div2)

        var container = document.getElementById("col1");
        var div3 = document.createElement("div");
        div3.innerHTML ="<img src=\"picture/user/"  + myObj['picture'] + "\" class=\"rounded-circle\" height = \" 200-\" width= \" 200\" >" + "<br><br>";
        container.appendChild(div3)
        
      }
    };
    xmlhttp.open("GET", "getUser.php?userId=" + id , true);
    xmlhttp.send();

  </script>
  <!-- Script For Second Row -->
  <script>
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var myObj = JSON.parse(this.responseText);

      var container = document.getElementById("table1");
      var tableCon = document.createElement("tr")
      tableCon.innerHTML = 
      "<td>"+myObj.event+"</td>"
      +"<td>"+myObj.president_name+' '+myObj.president_surname+"</td>";
      container.appendChild(tableCon);
      }
    };
      xmlhttp.open("GET", "getActivity.php?userId="+ id , true);
      xmlhttp.send();
  </script>
  <!-- SCRIPT FOR ADD ACTIVITY -->
  <script>
    var row = new Array();
    var xmlhttp = new XMLHttpRequest();
    var data;
    var dataAdd;
    xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      data = JSON.parse(this.responseText);
      var container = document.getElementById("myList");
      console.log(data);
      for(var i=0; i<data.length;i++)
        {
            row[i] = document.createElement("option");
            row[i].setAttribute("class","search_list")
            // row[i].setAttribute("id","org_text")
            row[i].value = data[i].event_id;
            row[i].innerHTML =  data[i].event
            container.appendChild(row[i]);
        }

        $(document).ready(function(){
          $("#search").change(function(){
            if($(this).val() == '')// If There's no text in search box, it will show nothing
              {
              }
            else{
              var result = document.getElementById("search").value; //Get data to searching
              //Searching for event in Index
              for(var j=0; j<data.length;j++){
                //Print event when it found
                if(data[j].event_id == result){
                  document.getElementById("org_txt").innerHTML = data[j].event;
                  document.getElementById("pre_org_txt").innerHTML = data[j].student_name +' '+data[j].student_surname;
                  dataAdd = data[j];
                  console.log(dataAdd);
                  }
                }
              }
          });
          
          $("#btn1").click(function(){
            fetch("testGet.php", {
			      method: "POST",
			      body: JSON.stringify(dataAdd)
		        }).then(async res => {
          //   debugging
              const data = await res.text();
              console.log("server res", data);
            });
          })      
        });

      }
    };
      xmlhttp.open("GET", "findActivity.php?userId=" + id, true);
      xmlhttp.send();
      
  </script>
  <!-- Trying to use Jquery -->

  <!-- Script For Third Row -->
  <script>
     var xmlhttp = new XMLHttpRequest();
     xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var myObj = JSON.parse(this.responseText);
  
        var container = document.getElementById("table3");
        var tableCon = document.createElement("tr")
        tableCon.innerHTML = "<td>"+myObj.organization+"</td><td>"+myObj.president_name+" "+myObj.president_surname+"</td>";
        container.appendChild(tableCon);
        }
      };
      xmlhttp.open("GET", "getOrganization.php?userId="+ id , true);
      xmlhttp.send();
  </script>
  <!-- script for last row -->
  <script>
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var myObj = JSON.parse(this.responseText);

        var container = document.getElementById("table4");
        var tableCon = document.createElement("tr")
        var i = 0;
        var j = 0;
        for (i in myObj)
          {
          rowBuilding = "<td rowspawn="+myObj[i].floor.length+">"+myObj[i].building+"</td>";
                  
          for(j in myObj[i].floor)
            {
            rowBuilding = rowBuilding+"<tr rowspawn="+myObj[i].floor.length+">"+myObj[i].building+"</td>";
            for(k in myObj[i].floor[j].place)
              tableCon.innerHTML = "<td>"+myObj[i].building+"</td>"+
                "<td>"+myObj[i].floor[j]['floor']+"</td>"+
                "<td>"+myObj[i].floor[j].place[k]['place']+"</td>";
                  }
                  container.appendChild(tableCon);
                } 
      }
    };
    xmlhttp.open("GET", "getResponsiblePlace.php?userId=60070503415" , true);
    xmlhttp.send();
  </script>
</html>
