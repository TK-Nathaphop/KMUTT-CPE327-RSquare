<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/custom.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        <link rel="icon" href="images/logo/Artboard 1logo.png">
        <script src="js/jquery-3.4.1.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/custom.js"></script>
        <!-- asdsadsad-->
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
        <link rel="stylesheet" href="dist/css/bootstrap-select.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!--<script src="dist/js/bootstrap-select.js"></script> -->

        <title>R-Square</title>
        <link rel="icon" href="picture/logo/Artboard 1logo.png" />
    </head>
  <body>
      <div id="nav-placeholder"> </div>
        <script>
            $.get("navigationbar.html", function(data){
                $("#nav-placeholder").replaceWith(data);
            });
        </script>
    <!-- /Head of the Card -->
    <div class="container">
      <div class="container">
        <div class="row justify-content-center">
          <h1 class="vdark-blue">View User</h1>
        </div>
        <div class="container-fluid">
          <!--------------------------------First Row------------------------------>
          <div class="row">
            <div class="col-3">
                <div class = "row" id = "picture">
                  <img src="picture/user/null-pic.png" class=rounded-circle height = "150" width=  "150" >
                </div>
            </div>
            <!--Detail of User-->
            <!--Column of Detail User1-->
            <div class="col-4" id ="display_info">
              <div class="row" >
                <h4 class="vdark-blue">Name:&nbsp&nbsp&nbsp&nbsp</h4>
                <h4 id="name"></h4>
              </div>
              <div class="row" >
                <h4 class="vdark-blue">Faculty:&nbsp&nbsp</h4>
                <h4 id="faculty"></h4>
              </div>
              <div class="row" >
                <h4 class="vdark-blue">Postion:&nbsp&nbsp</h4>
                <h4 id="position"></h4>
                <div class="col" id = "edit_position">

                  <!-- Edit modal pop-up -->
                  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" 
                  aria-labelledby="exampleModalLabel" data-toggle ="modal"aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="editModal">Modal title</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <h4>Edit</h4>
                          <div class="dropdown">
                              <button class="btn btn-secondary dropdown-toggle" type="button" id="edit_dropdown_btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Dropdown button
                              </button>
                              <div class="dropdown-menu" aria-labelledby="edit_dropdown_btn" id="edit_dropdown_list">
                                <a class="dropdown-item" href="#">Something else here</a>
                              </div>
                          </div>
                          <form>
                            <div class="form-group">
                              <label for="exampleFormControlSelect1">Example select</label>
                              <select class="form-control" id="edit_dropdown_list">
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                              </select>
                            </div>
                          </form>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                          <button type="button" class="btn btn-primary">Save changes</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!--Column of Detail User2-->
            <div class="col-5">
              <div class = "row">
                <h4 class="vdark-blue">Role:&nbsp</h4>
                <h4 id="role"></h4>
              </div>
              <div class = "row">
                  <h4 class="vdark-blue">Department:&nbsp</h4>
                  <h4 id="department"></h4>
                </div>
            </div>
          </div>
            <br> <!-- Space between row 1 and row 2 -->
            <!--------------------------------Second Row------------------------------>
            <div class="row">
              <h4 class="font-weight-bold justify-content-left vdark-blue ">
                Responsible Activity Project
              </h4>
              <!--Table of Activity infomation-->
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Project</th>
                      <th scope="col"> President</th>
                    </tr>
                  </thead>
                  <tbody id="table1">
                    <!-- Get data from script -->
                  </tbody>
                </table>
              </div>
            </div>
            <!-- Popup Add-Activity Button -->
            <div class = "row">
              <div class ="col-sm-10"></div>
              <div class = "col-sm-2">
                <button type="button" class="btn p-3 w-100 btn-primary" data-toggle="modal" data-target="#exampleModal" data-whatever="@getbootstrap" >Add Activity</button>

                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">

                    <!---------------------- Popup content ---------------------->
                    <div class="modal-content">
                      <div class="modal-body">
                        <div class="container-fluid">
                          <div class = "row justify-content-center">
                            <h3 class="vdark-blue font-weight-bold text-center"> Add Activity</h3>
                          </div>
                          <!---------------------- searching ---------------------->
                          <div class ="row">
                            <h4 class = "vdark-blue">Search</h4>
                          </div>
                          <!-- Input for Searching Event -->
                          <form action="/findActivity.php" method="get">
                            <input type ="text" class="form-control" list="myList" id = "search" name="myList" placeholder = "Search">
                            <datalist id="myList"> 
                              <!-- List of Resonsible for user that can added -->
                            </datalist>
                          </form>
                          <br>
                          <!-- Row1 -->
                          <div class="row">
                            <h4 class="vdark-blue" id="org">Activity Name:&nbsp</h4>
                            <h4 id=org_txt> </h4>
                          </div>
                          <!-- Row2 -->
                          <div class="row">
                            <h4 class = "vdark-blue">President:&nbsp</h4>
                            <h4 id=pre_org_txt> </h4>
                          </div>
                          <!-- Row3 -->
                          <div class="row ">
                            <div class="col-md-10"></div>
                            <div class = "col-sm-2">
                              <input class="btn btn-primary" type="submit" value="Submit" id ="btn1">
                            </div>
                          </div>
                          <br>
                        </div>
                      </div>
                    </div>
                    <!-- End of Content -->
                  </div>
                </div>
              </div>
            </div>
            <!--------------------------------Third Row------------------------------>
            <div class="row">
              <h4 class="font-weight-bold justify-content-left vdark-blue">
                Responsible Organization
              </h4>
              <!--Table of Responsible Organization-->
              <div class = "table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Organization Name</th>
                      <th scope="col">President</th>
                    </tr>
                  </thead>
                  <tbody id="table3">
                  </tbody>
                </table>
              </div>
            </div>
            <!-- Popup Add-Activity Button -->
            <div class="row">
              <div class = "col-sm-10"></div>
              <div class = "col-sm-2">
                <button type="button" class="btn p-3 w-100 btn-primary" data-toggle="modal" data-target="#addOrganize" data-whatever="@addOrganize">Add Organization</button>

                <div class="modal fade" id="addOrganize" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
  
                        <!---------------------- Popup content ---------------------->
                    <div class="modal-content">
                      <div class="modal-body">
                        <div class="container-fluid">
                          <div class = "row justify-content-center">
                            <h3 class="vdark-blue font-weight-bold text-center"> Add Organization</h3>
                          </div>
                              <!---------------------- searching ---------------------->
                          <div class ="row">
                            <h4 class = "vdark-blue">Search</h4>
                          </div>
                              <!-- Input for Searching Event -->
                          <form action="/findOrganization.php" method="get">
                            <input type ="text" class="form-control" list="organizeList"  id = "organize_search" name="organizeList" placeholder = "Search">
                              <datalist id="organizeList"> 
                                <!-- List of Resonsible for user that can added -->
                              </datalist>
                          </form>
                          <br>
                          <!-- Row1 -->
                          <div class="row">
                            <h4 class="vdark-blue" id="org">Organization Name:&nbsp</h4>
                            <h5 id="organize"> </h5>
                          </div>
                          <!-- Row2 -->
                          <div class="row">
                            <h4 class = "vdark-blue">President:&nbsp</h4>
                            <h4 id="organizeName"> </h4>
                          </div>
                          <!-- Row3 -->
                          <div class="row ">
                            <div class="col-md-10"></div>
                            <div class = "col-sm-2">
                              <input class="btn btn-primary" type="submit" value="Submit" id ="btn2">
                            </div>
                          </div>

                          <br>
                        </div>
                      </div>
                    </div>
                        <!-- End of Content -->
                   </div>
                </div>
              </div>
            </div>
            <!--------------------------------fourth Row------------------------------>
            <div class="row">
              <h4 class="font-weight-bold justify-content-left vdark-blue">
                Responsible Place
              </h4>
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">Building</th>
                    <th scope="col">Floor</th>
                    <th scope ="col">Place</th>
                  </tr>
                </thead>
                <tbody id ="table4">
                </tbody>
              </table>
                <button type="button" class="btn btn-primary" onclick="myfunction()">
                  Add Place
                </button>
              
            </div>
          <!-- /Card of Connent -->
        </div>
      </div>
    </div>
  </body>
  <!-- Script For First Row -->
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");
    var myObj; 
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        myObj = JSON.parse(this.responseText);
        console.log(myObj);
        var user_name = document.getElementById("name").innerHTML = myObj.name+' '+myObj.surname
        var user_faculty = document.getElementById("faculty").innerHTML = myObj.faculty
        var user_postion = document.getElementById("position").innerHTML = myObj.position
        var user_role = document.getElementById("role").innerHTML = myObj.role
        var user_department = document.getElementById("department").innerHTML = myObj.department
        var user_picture = document.getElementById("picture");
        //Edit button for position
        var a = document.createElement("a");
        a.setAttribute("onclick","editPosition('"+myObj+"')");
        a.setAttribute("data-target","#editModal");
        a.setAttribute("data-toggle","modal");
        a.setAttribute("id","edit_modal_btn");
        a.innerHTML = "<u>Edit</u>"
        var edit_position = document.getElementById("edit_position");
        //Dispaly image of user
        user_picture.innerHTML = "<img src=\"picture/user/"  + myObj.picture+ "\" class=\"rounded-circle\" height = \" 150\" width= \" 150\" >" + "<br><br>"
        edit_position.appendChild(a);
        //"<div class = \"row\">"
        // +"<h4 class =  \"vdark-blue\"> Name:</h4>" + ' '+"<h4>"+myObj.name + ' ' + myObj.surname +"</h4>"+"</div>"
        // +"<div class = \"row\">"+"<h4 class =  \"vdark-blue\"> Faculty:</h4>" +' '+"<h4>"+ myObj.faculty+"</h4>"+"</div>"
        // +"<div class = \"row\">"+"<h4 class =  \"vdark-blue\"> Position:</h4>" +' '+"<h4>"+ myObj.position+"</h4>"+"</div>";
      }
    };
    xmlhttp.open("GET", "getUser.php?userId=" + id , true);
    xmlhttp.send();

    function editPosition()
      {
        var positionOption;
        // console.log(myObj.role);
        if(myObj.role == "staff")
          {
          console.log("role = staff");
          if(myObj.position == "coordinator")
            {
            document.getElementById("edit_dropdown_list").innerHTML = "<a class=\"dropdown-item\">Position_2<a>";
            document.getElementById("edit_dropdown_list").innerHTML = "<a class=\"dropdown-item\">Position_3<a>";
            //<a class="dropdown-item" href="#">Something else here</a>
            }
          }
      }

  </script>
  <!-- Script For Second Row -->
  <script>
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var myObj = JSON.parse(this.responseText);

      var container = document.getElementById("table1");
      var tableCon = document.createElement("tr")
      tableCon.innerHTML = 
      "<td>"+myObj.event+"</td>"
      +"<td>"+myObj.president_name+' '+myObj.president_surname+"</td>";
      container.appendChild(tableCon);
      }
    };
      xmlhttp.open("GET", "getActivity.php?userId="+ id , true);
      xmlhttp.send();
  </script>
  <!-- SCRIPT FOR ADD ACTIVITY -->
  <script>
    var row = new Array();
    var xmlhttp = new XMLHttpRequest();
    let data;
    let dataAdd;
    xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      data = JSON.parse(this.responseText);
      var container = document.getElementById("myList");
      for(var i=0; i<data.length;i++)
        {
            row[i] = document.createElement("option");
            row[i].setAttribute("class","search_list")
            row[i].setAttribute("id","org_text")
            row[i].value = data[i].event_id;
            row[i].innerHTML =  data[i].event
            container.appendChild(row[i]);
        }

        $(document).ready(function(){
          $("#search").change(function(){
            if($(this).val() == '')// If There's no text in search box, it will show nothing
              {
              }
            else{
              var result = document.getElementById("search").value; //Get data to searching
              //Searching for event in Index
              for(var j=0; j<data.length;j++){
                //Print event when it found
                if(data[j].event_id == result){
                  document.getElementById("org_txt").innerHTML = data[j].event;
                  document.getElementById("pre_org_txt").innerHTML = data[j].student_name +' '+data[j].student_surname;
                  dataAdd = data[j];
                  console.log(dataAdd);
                  }
                }
              }
          });
          
          $("#btn1").click(function(){
            fetch("testGet.php", {
			      method: "POST",
			      body: JSON.stringify(dataAdd.event_id)
            
		        }).then(async res => {
          //   debugging
              const data = await res.text();
              console.log("server res", data);
            });
          })      
        });

      }
    };
      xmlhttp.open("GET", "findActivity.php?userId=" + id, true);
      xmlhttp.send();
  </script>
  <!-- SCRIPT FOR ADD ORGANIZATION -->
  <script>
    let rowOrganize = new Array();
    var xmlhttp = new XMLHttpRequest();
    let dataOrganize;
    let addOrganzie;
    xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      dataOrganize = JSON.parse(this.responseText);
      var container = document.getElementById("organizeList");
      console.log(dataOrganize);
      for(var i=0; i<dataOrganize.length;i++)
        {
          rowOrganize[i] = document.createElement("option");
          rowOrganize[i].setAttribute("class","search_list")
          // rowOrganize[i].setAttribute("id","organize")
          rowOrganize[i].value = dataOrganize[i].organization_id;
          rowOrganize[i].innerHTML =  dataOrganize[i].organization
          container.appendChild(rowOrganize[i]);
        }

        $(document).ready(function(){
          $("#organize_search").change(function(){
            if($(this).val() == '')// If There's no text in search box, it will show nothing
              {
              }
            else{
              var result = document.getElementById("organize_search").value; //Get data to searching
              //Searching for event in Index
              for(var j=0; j<dataOrganize.length;j++){
                //Print event when it found
                if(dataOrganize[j].organization_id == result){
                  document.getElementById("organize").innerHTML = dataOrganize[j].organization
                  document.getElementById("organizeName").innerHTML = dataOrganize[j].student_name +' '+dataOrganize[j].student_surname
                  addOrganize = dataOrganize[j];
                  console.log(addOrganize);
                  }
                }
              }
          });
          
          $("#btn2").click(function(){
            fetch("testGet.php", {
			      method: "POST",
			      body: JSON.stringify(addOrganize)
		        }).then(async res => {
          //   debugging
              const data = await res.text();
              console.log("server res", data);
            });
          })      
        });

      }
    };
      xmlhttp.open("GET", "findOrganization.php?userId=" + id, true);
      xmlhttp.send();
  </script>
  <!-- Script For Third Row -->
  <script>
     var xmlhttp = new XMLHttpRequest();
     xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var myObj = JSON.parse(this.responseText);
  
        var container = document.getElementById("table3");
        var tableCon = document.createElement("tr")
        tableCon.innerHTML = "<td>"+myObj.organization+"</td><td>"+myObj.president_name+" "+myObj.president_surname+"</td>";
        container.appendChild(tableCon);
        }
      };
      xmlhttp.open("GET", "getOrganization.php?userId="+ id , true);
      xmlhttp.send();
  </script>
  <!-- script for last row -->
  <script>
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var myObj = JSON.parse(this.responseText);

        var container = document.getElementById("table4");
        var tableCon = document.createElement("tr")
        var i = 0;
        var j = 0;
        for (i in myObj)
          {
          rowBuilding = "<td rowspawn="+myObj[i].floor.length+">"+myObj[i].building+"</td>";
                  
          for(j in myObj[i].floor)
            {
            rowBuilding = rowBuilding+"<tr rowspawn="+myObj[i].floor.length+">"+myObj[i].building+"</td>";
            for(k in myObj[i].floor[j].place)
              tableCon.innerHTML = "<td>"+myObj[i].building+"</td>"+
                "<td>"+myObj[i].floor[j]['floor']+"</td>"+
                "<td>"+myObj[i].floor[j].place[k]['place']+"</td>";
                  }
                  container.appendChild(tableCon);
                } 
      }
    };
    xmlhttp.open("GET", "getResponsiblePlace.php?userId=60070503429" , true);
    xmlhttp.send();
  </script>
</html>
